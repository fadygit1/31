#!/bin/bash

# Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¥Ù†Ø´Ø§Ø¦ÙŠØ©
# Ù…Ù„Ù ØªØ´ØºÙŠÙ„ Ù„Ù„Ø£Ù†Ø¸Ù…Ø© Unix/Linux/Mac

clear
echo "========================================"
echo "   Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¥Ù†Ø´Ø§Ø¦ÙŠØ©"
echo "========================================"
echo ""
echo "Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬..."
echo ""

# Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
cd "$(dirname "$0")"

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Node.js
if ! command -v node &> /dev/null; then
    echo "âŒ Ø®Ø·Ø£: Node.js ØºÙŠØ± Ù…Ø«Ø¨Øª Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…"
    echo ""
    echo "ÙŠØ±Ø¬Ù‰ ØªØ«Ø¨ÙŠØª Node.js Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ§Ù„ÙŠ:"
    echo "https://nodejs.org"
    echo ""
    read -p "Ø§Ø¶ØºØ· Enter Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©..."
    exit 1
fi

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¬Ù„Ø¯ project
if [ ! -d "project" ]; then
    echo "âŒ Ø®Ø·Ø£: Ù…Ø¬Ù„Ø¯ project ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"
    echo "ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙÙŠ Ù…Ø¬Ù„Ø¯ project"
    echo ""
    read -p "Ø§Ø¶ØºØ· Enter Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©..."
    exit 1
fi

cd project

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ package.json
if [ ! -f "package.json" ]; then
    echo "âŒ Ø®Ø·Ø£: Ù…Ù„Ù package.json ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"
    echo "ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ØµØ­ÙŠØ­Ø©"
    echo ""
    read -p "Ø§Ø¶ØºØ· Enter Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©..."
    exit 1
fi

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
if [ ! -d "node_modules" ]; then
    echo "ðŸ“¦ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰..."
    echo "Ù‡Ø°Ø§ Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø¨Ø¶Ø¹ Ø¯Ù‚Ø§Ø¦Ù‚..."
    echo ""
    npm install
    if [ $? -ne 0 ]; then
        echo "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª"
        echo ""
        read -p "Ø§Ø¶ØºØ· Enter Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©..."
        exit 1
    fi
    echo "âœ… ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø¨Ù†Ø¬Ø§Ø­"
    echo ""
fi

echo "ðŸš€ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬..."
echo ""
echo "Ø³ØªÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØªØµÙØ­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù„Ù‰:"
echo "http://localhost:5173"
echo ""
echo "âš ï¸  Ù„Ø§ ØªØºÙ„Ù‚ Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬"
echo ""

# ÙØªØ­ Ø§Ù„Ù…ØªØµÙØ­ (Ø­Ø³Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù…)
if command -v xdg-open &> /dev/null; then
    # Linux
    sleep 3 && xdg-open "http://localhost:5173" &
elif command -v open &> /dev/null; then
    # macOS
    sleep 3 && open "http://localhost:5173" &
fi

# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
npm run dev